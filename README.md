# ClickCheck Project

ClickCheck — проект визового центра, разработанный на Django с использованием:

- **Django Channels** и **Daphne** для поддержки WebSocket и чата в реальном времени.
- **Redis** для хранения и обработки сообщений.
- **Nginx** для проксирования запросов и обслуживания статических файлов.
- Проект развернут в среде **Docker**, что обеспечивает лёгкость запуска и консистентность окружения.


## Развёртывание

Проект успешно развернут и доступен по адресу:
- https://click-check.ru


## Требования

- **Python** 3.9
- **Django** (включая Django Channels для WebSocket)
- **Redis** (кэш и брокер сообщений)
- **PostgreSQL** (реляционная база данных)
- **Daphne** (ASGI-сервер для WebSocket)
- **Nginx** (обратный прокси и обслуживание статических файлов)
- **Docker и Docker Compose** (для контейнеризации)

## Запуск проекта

Если требуется запуск проекта локально для тестирования, вы можете выполнить следующие шаги:

### 1. Клонируйте репозиторий

Клонируйте репозиторий и перейдите в директорию проекта:

```bash
git clone <URL вашего репозитория>
cd Visa4u_project
```

### 2. Создайте виртуальное окружение и установите зависимости:

```bash
python3 -m venv venv
source venv/bin/activate
pip install -r requirements.txt
```

### 3. Настройте Redis

Убедитесь, что Redis установлен и запущен:

```bash
brew install redis
brew services start redis
```

Проверьте, что Redis запущен:

```bash
redis-cli ping
```

Ожидаемый ответ: PONG.

### 4. Настройте базу данных

Убедитесь, что PostgreSQL установлен локально. Укажите параметры подключения в файле .env.

### 5. Примените миграции

```bash
python manage.py migrate
```

### 6. Соберите статические файлы

```bash
python manage.py collectstatic
```

### 7. Запустите Daphne

Daphne используется для обработки WebSocket-соединений. Убедитесь, что Daphne установлена:

```bash
pip install daphne
```

Запуск:

```bash
daphne -p 8001 Visa4u.asgi:application
```

### 8. Настройте Nginx

Nginx используется для обратного проксирования и обслуживания статических файлов. 
Пример конфигурации Nginx находится в config/nginx.conf.

Установите Nginx:

```bash
brew install nginx  # Для MacOS
```

Скопируйте файл конфигурации Nginx из config/nginx.conf в основную директорию конфигурации Nginx:

```bash
sudo cp config/nginx.conf /opt/homebrew/etc/nginx/nginx.conf  # Укажите правильный путь при необходимости
```

Перезапустите Nginx для применения изменений:

```bash
sudo nginx -s reload
```

### 9. Откройте проект в браузере
Проект будет доступен по адресу http://localhost.


## Важно: Добавление данных для корректной работы

Для корректной работы проекта необходимо вручную добавить страны США и Канада в базу данных, так как от них зависят связанные модели. Это можно сделать через Django Admin или Django Shell:

1. Через Django Admin:

- Откройте http://localhost/admin
- Войдите в админ-панель с предварительно созданным суперпользователем:
- В разделе "Страны" добавьте следующие записи: США, Канада
- Сохраните данные 

2. Альтернативный способ: Добавить через Django shell

```bash
python manage.py shell
```

```bash
from visas.models import Country

Country.objects.get_or_create(name="США")
Country.objects.get_or_create(name="Канада")
print("Страны добавлены успешно!")
```

После этого страны США и Канада будут добавлены в базу данных.

Почему это важно?
Связанные модели, такие как визы, чаты или другие функциональные элементы, используют страны США и Канада для работы. Без этих записей некоторые части проекта могут не работать корректно.


## Структура проекта:

- Visa4u/settings.py — настройки Django проекта.
- Dockerfile — инструкция для сборки Docker-образа.
- docker-compose.yml — описание сервисов Docker (веб-приложение, Redis, PostgreSQL, Nginx).
- config/nginx.conf — конфигурация Nginx.
- apps/ — приложения Django (основная логика, модели, представления и шаблоны).

## Примечания по развертыванию

- WebSocket: Для работы чата в реальном времени используется Daphne, которая обрабатывает WebSocket-соединения. Nginx настроен для проксирования запросов к Daphne.
- Redis: Redis используется как брокер сообщений для Django Channels и может быть использован для кэширования.
- Nginx: Nginx обслуживает статические файлы и проксирует запросы к приложению Django.

# Полезные команды

## Управление Docker:

- Запуск проекта:
```bash
docker-compose up
```

- Остановка проекта:
```bash
docker-compose down
```

## Управление базой данных:

- Вход в контейнер PostgreSQL:
```bash
docker exec -it visa4u-db-1 psql -U clickcheck_user -d clickcheck_project
```

